---
title: "batchQC Report"
author: "Solaiappan Manimaran"
date: "`r Sys.Date()`"
output: 
  html_vignette:
    toc: true
    toc_depth: 2
---

```{r, echo=FALSE}
eval_cell_1 = (bitwAnd(report_option, 1)==1)
```
`r if (eval_cell_1) 'Data Summary'`
`r if (eval_cell_1) '============'`
`r if (eval_cell_1) 'This is a summary of the given data matrix for the first 12 genes.'`
```{r eval=eval_cell_1, echo=FALSE, message=FALSE, fig.width = 8, fig.height = 8}
datasummary <- summary(t(dat))
panderOptions("table.split.table", 120)  ## table split at 100 (default 80) characters in a line
pander(datasummary[,1:12])
boxplot(t(dat)[,1:12])
```

```{r, echo=FALSE}
eval_cell_2 = (bitwAnd(report_option, 2)==2)
```
`r if (eval_cell_2) 'Heatmap'`
`r if (eval_cell_2) '======='`
`r if (eval_cell_2) 'This is a heatmap of the given data matrix showing the batch effects and variations with different conditions.'`
```{r, eval=eval_cell_2, echo=FALSE, message=FALSE, fig.width = 8, fig.height = 8}
batchqc_heatmap(dat, batch=batch, mod=mod)
```

```{r, echo=FALSE}
eval_cell_3 = (bitwAnd(report_option, 4)==4)
```
`r if (eval_cell_3) 'Sample Correlations'`
`r if (eval_cell_3) '==================='`
`r if (eval_cell_3) 'This is a heatmap of the correlation between samples.'`
```{r, eval=eval_cell_3, echo=FALSE, message=FALSE, fig.width = 8, fig.height = 8}
batchqc_correlation(dat, batch=batch, mod=mod)
```

```{r, echo=FALSE}
eval_cell_4 = (bitwAnd(report_option, 8)==8)
```
`r if (eval_cell_4) 'This plot helps identify outlying samples.'`
```{r, eval=eval_cell_4, echo=FALSE, message=FALSE, fig.width = 8, fig.height = 8}
batchqc_corscatter(dat, batch=batch, mod=mod)
```

```{r, echo=FALSE}
eval_cell_5 = (bitwAnd(report_option, 16)==16)
```
`r if (eval_cell_5) 'PCA: Principal Component Analysis'`
`r if (eval_cell_5) '================================='`
`r if (eval_cell_5) 'This is a plot of the top two principal components and showing the variation with respect to batch effects and different conditions.'`
```{r, eval=eval_cell_5, echo=FALSE, message=FALSE, fig.width = 8, fig.height = 8}
pca <- batchqc_pca(dat, batch=batch, mod=mod)
```

```{r, echo=FALSE}
eval_cell_6 = (bitwAnd(report_option, 32)==32)
```
`r if (eval_cell_6) 'PCA Proportion Variation and correlation'`
`r if (eval_cell_6) '========================================'`
```{r, eval=eval_cell_6, echo=FALSE, message=FALSE, fig.width = 8, fig.height = 8}
res <- batchqc_pca_svd(dat, batch=batch, mod=mod)
```

```{r, echo=FALSE}
eval_cell_7 = (bitwAnd(report_option, 64)==64)
```
`r if (eval_cell_7) 'PCA Proportion Variation and correlation Table'`
`r if (eval_cell_7) '=============================================='`
```{r, eval=eval_cell_7, echo=FALSE, message=FALSE}
panderOptions("table.split.table", Inf)  ## don't split tables
pander(res)
```

```{r, echo=FALSE}
eval_cell_8 = (bitwAnd(report_option, 128)==128)
```
`r if (eval_cell_8) 'Combat Plots'`
`r if (eval_cell_8) '============'`
`r if (eval_cell_8) 'This is a plot showing whether parametric or non-parameteric prior is appropriate for this data. It also shows the Kolmogorov-Smirnov test comparing the parametric and non-parameteric prior distribution.'`
```{r, eval=eval_cell_8, echo=FALSE, message=FALSE}
kstest <- combatPlot(dat, batch=batch, mod=mod)
print(kstest)
```

```{r, echo=FALSE}
eval_cell_9 = (bitwAnd(report_option, 256)==256)
```
`r if (eval_cell_9) 'Batch Effects testing'`
`r if (eval_cell_9) '====================='`
`r if (eval_cell_9) 'This is a summary of the statistical test for batch effects.'`
```{r, eval=eval_cell_9, echo=FALSE, message=FALSE}
retval <- batchtest(pca, batch=batch, mod=mod)
```
